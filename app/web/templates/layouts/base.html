<!doctype html>
<html lang="en">
  <!--begin::Head-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>{% if title %}{{ title }} - ProductInsights{% else %}ProductInsights - Content Analysis Platform{% endif %}</title>

    <!--begin::Accessibility Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="color-scheme" content="light dark" />
    <meta name="theme-color" content="#007bff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
    <!--end::Accessibility Meta Tags-->

    <!--begin::Primary Meta Tags-->
    <meta name="title" content="ProductInsights - Content Analysis Platform" />
    <meta name="author" content="ProductInsights Team" />
    <meta name="description" content="Comprehensive content analysis platform for Amazon, Twitter, Instagram, and TikTok insights." />
    <!--end::Primary Meta Tags-->

    <!--begin::Fonts-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" 
          integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous" />
    <!--end::Fonts-->

    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css" crossorigin="anonymous" />
    <!--end::Third Party Plugin(OverlayScrollbars)-->

    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" 
          integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI=" crossorigin="anonymous" />
    <!--end::Third Party Plugin(Bootstrap Icons)-->

    <!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0/dist/css/adminlte.min.css" />
    <!--end::Required Plugin(AdminLTE)-->

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js for advanced visualizations -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- Custom CSS -->
    <style>
      .content-analysis-card {
        border-left: 4px solid #007bff;
      }
      .sentiment-positive { color: #28a745; }
      .sentiment-negative { color: #dc3545; }
      .sentiment-neutral { color: #6c757d; }
      .emotion-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        margin: 0.125rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 500;
      }
      .quality-score {
        font-size: 2rem;
        font-weight: bold;
      }
      .recommendation-card {
        border-left: 4px solid #fd7e14;
      }
      .priority-high { border-left-color: #dc3545 !important; }
      .priority-medium { border-left-color: #fd7e14 !important; }
      .priority-low { border-left-color: #28a745 !important; }
      
      /* User avatar sizing */
      .user-image {
        max-width: 32px;
        max-height: 32px;
        width: 32px !important;
        height: 32px !important;
      }
      
      .user-header img {
        max-width: 80px;
        max-height: 80px;
        width: 80px !important;
        height: 80px !important;
      }
      
      /* Ensure all profile images are constrained */
      img[alt*="Profile"], img[alt*="User Image"] {
        object-fit: cover;
      }
      
      /* Force light theme styling */
      body {
        background-color: #f8f9fa !important;
        color: #212529 !important;
      }
      
      .app-wrapper {
        background-color: #ffffff !important;
      }
      
      .app-main {
        background-color: #f8f9fa !important;
      }
      
      .app-content {
        background-color: #f8f9fa !important;
      }
      
      .card {
        background-color: #ffffff !important;
        color: #212529 !important;
        border: 1px solid #dee2e6 !important;
      }
      
      .form-control {
        background-color: #ffffff !important;
        color: #212529 !important;
        border: 1px solid #ced4da !important;
      }
      
      .nav-link {
        color: #495057 !important;
      }
      
      .nav-link:hover {
        color: #007bff !important;
      }
      
      .sidebar-menu .nav-link {
        color: #495057 !important;
      }
      
      .sidebar-menu .nav-link:hover {
        background-color: #e9ecef !important;
        color: #007bff !important;
      }
      
      /* Button styling */
      .btn {
        border: 1px solid transparent !important;
      }
      
      .btn-primary {
        background-color: #007bff !important;
        border-color: #007bff !important;
        color: #ffffff !important;
      }
      
      .btn-primary:hover {
        background-color: #0056b3 !important;
        border-color: #0056b3 !important;
      }
      
      .btn-secondary {
        background-color: #6c757d !important;
        border-color: #6c757d !important;
        color: #ffffff !important;
      }
      
      .btn-outline-secondary {
        background-color: transparent !important;
        border-color: #6c757d !important;
        color: #6c757d !important;
      }
      
      .btn-outline-secondary:hover {
        background-color: #6c757d !important;
        color: #ffffff !important;
      }
      
      /* Table styling */
      .table {
        background-color: #ffffff !important;
        color: #212529 !important;
      }
      
      .table th, .table td {
        border-color: #dee2e6 !important;
      }
      
      /* Alert styling */
      .alert {
        border: 1px solid transparent !important;
      }
      
      .alert-success {
        background-color: #d1e7dd !important;
        border-color: #badbcc !important;
        color: #0f5132 !important;
      }
      
      .alert-danger {
        background-color: #f8d7da !important;
        border-color: #f5c2c7 !important;
        color: #721c24 !important;
      }
      
      .alert-warning {
        background-color: #fff3cd !important;
        border-color: #ffecb5 !important;
        color: #664d03 !important;
      }
      
      .alert-info {
        background-color: #d1ecf1 !important;
        border-color: #bee5eb !important;
        color: #055160 !important;
      }
      
      /* Non-authenticated layout styling */
      .login-page {
        background-color: #f8f9fa !important;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      
      .login-box {
        width: 100%;
        max-width: 400px;
      }
      
      .login-box .card {
        background-color: #ffffff !important;
        border: 1px solid #dee2e6 !important;
        border-radius: 0.5rem !important;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
      }
      
      .login-box .card-header {
        background-color: #f8f9fa !important;
        border-bottom: 1px solid #dee2e6 !important;
        padding: 1.5rem !important;
      }
      
      .login-box .card-body {
        padding: 2rem !important;
      }
      
      .login-box-msg {
        margin-bottom: 1rem !important;
        color: #6c757d !important;
        text-align: center;
      }
    </style>

    {% block additional_head %}{% endblock %}
  </head>
  <!--end::Head-->

  <!--begin::Body-->
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary" data-bs-theme="light">
    <!--begin::App Wrapper-->
    <div class="app-wrapper">
      {% if current_user.is_authenticated %}
        <!--begin::Header-->
        <nav class="app-header navbar navbar-expand bg-body">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Start Navbar Links-->
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
                  <i class="bi bi-list"></i>
                </a>
              </li>
              <li class="nav-item d-none d-md-block">
                <a href="{{ url_for('dashboard.home') }}" class="nav-link">Dashboard</a>
              </li>
              <li class="nav-item d-none d-md-block">
                <a href="{{ url_for('dashboard.new_analysis') }}" class="nav-link">New Analysis</a>
              </li>
            </ul>
            <!--end::Start Navbar Links-->

            <!--begin::End Navbar Links-->
            <ul class="navbar-nav ms-auto">
              <!--begin::User Menu Dropdown-->
              <li class="nav-item dropdown user-menu">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                    <img src="{{ url_for('static', filename='profile_pics/' + (current_user.avatar_url or 'default.jpg')) }}"
                       class="user-image rounded-circle shadow" alt="User Image" 
                       style="width: 32px; height: 32px; object-fit: cover;" />
                  <span class="d-none d-md-inline">{{ current_user.username }}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
                  <!--begin::User Image-->
                  <li class="user-header text-bg-primary">
                    <img src="{{ url_for('static', filename='profile_pics/' + (current_user.avatar_url or 'default.jpg')) }}" 
                         class="rounded-circle shadow" alt="User Image" 
                         style="width: 80px; height: 80px; object-fit: cover; margin: auto; display: block;" />
                    <p>
                      {{ current_user.username }}
                      <small>Content Analysis Expert</small>
                    </p>
                  </li>
                  <!--end::User Image-->

                  <!--begin::Menu Footer-->
                  <li class="user-footer">
                    <a href="{{ url_for('dashboard.profile') }}" class="btn btn-default btn-flat">Profile</a>
                    <a href="{{ url_for('auth.logout') }}" class="btn btn-default btn-flat float-end">Sign out</a>
                  </li>
                  <!--end::Menu Footer-->
                </ul>
              </li>
              <!--end::User Menu Dropdown-->
            </ul>
            <!--end::End Navbar Links-->
          </div>
          <!--end::Container-->
        </nav>
        <!--end::Header-->

        <!--begin::Sidebar-->
        <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="light">
          <!--begin::Sidebar Brand-->
          <div class="sidebar-brand">
            <!--begin::Brand Link-->
            <a href="{{ url_for('dashboard.home') }}" class="brand-link">
              <i class="bi bi-graph-up brand-image opacity-75 shadow" style="font-size: 2rem; color: #007bff;"></i>
              <span class="brand-text fw-light">ProductInsights</span>
            </a>
            <!--end::Brand Link-->
          </div>
          <!--end::Sidebar Brand-->

          <!--begin::Sidebar Wrapper-->
          <div class="sidebar-wrapper">
            <nav class="mt-2">
              <!--begin::Sidebar Menu-->
              <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
                
                <!-- Dashboard -->
                <li class="nav-item">
                  <a href="{{ url_for('dashboard.home') }}" class="nav-link {{ 'active' if request.endpoint == 'dashboard.home' }}">
                    <i class="nav-icon bi bi-speedometer2"></i>
                    <p>Dashboard</p>
                  </a>
                </li>

                <!-- New Analysis -->
                <li class="nav-item">
                  <a href="{{ url_for('dashboard.new_analysis') }}" class="nav-link {{ 'active' if request.endpoint == 'dashboard.new_analysis' }}">
                    <i class="nav-icon bi bi-plus-circle"></i>
                    <p>New Analysis</p>
                  </a>
                </li>

                <!-- Platform Analyses -->
                <li class="nav-item {{ 'menu-open' if request.endpoint and 'platform_analysis' in request.endpoint }}">
                  <a href="#" class="nav-link">
                    <i class="nav-icon bi bi-bar-chart"></i>
                    <p>
                      Platform Analysis
                      <i class="nav-arrow bi bi-chevron-right"></i>
                    </p>
                  </a>
                  <ul class="nav nav-treeview">
                    <li class="nav-item">
                      <a href="{{ url_for('dashboard.platform_analysis', platform='amazon') }}" class="nav-link">
                        <i class="nav-icon bi bi-shop"></i>
                        <p>Amazon Reviews</p>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="{{ url_for('dashboard.platform_analysis', platform='twitter') }}" class="nav-link">
                        <i class="nav-icon bi bi-twitter"></i>
                        <p>Twitter Analysis</p>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="{{ url_for('dashboard.platform_analysis', platform='instagram') }}" class="nav-link">
                        <i class="nav-icon bi bi-instagram"></i>
                        <p>Instagram Analysis</p>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="{{ url_for('dashboard.platform_analysis', platform='tiktok') }}" class="nav-link">
                        <i class="nav-icon bi bi-tiktok"></i>
                        <p>TikTok Analysis</p>
                      </a>
                    </li>
                  </ul>
                </li>

                <!-- Settings -->
                <li class="nav-item">
                  <a href="{{ url_for('dashboard.settings') }}" class="nav-link {{ 'active' if request.endpoint == 'dashboard.settings' }}">
                    <i class="nav-icon bi bi-gear"></i>
                    <p>Settings</p>
                  </a>
                </li>

                <!-- Profile -->
                <li class="nav-item">
                  <a href="{{ url_for('dashboard.profile') }}" class="nav-link {{ 'active' if request.endpoint == 'dashboard.profile' }}">
                    <i class="nav-icon bi bi-person"></i>
                    <p>Profile</p>
                  </a>
                </li>

              </ul>
              <!--end::Sidebar Menu-->
            </nav>
          </div>
          <!--end::Sidebar Wrapper-->
        </aside>
        <!--end::Sidebar-->

        <!--begin::App Main-->
        <main class="app-main">
          <!--begin::App Content Header-->
          <div class="app-content-header">
            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-6">
                  <h3 class="mb-0">{% block page_title %}Dashboard{% endblock %}</h3>
                </div>
                <div class="col-sm-6">
                  <ol class="breadcrumb float-sm-end">
                    {% block breadcrumb %}
                    <li class="breadcrumb-item"><a href="{{ url_for('dashboard.home') }}">Home</a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                    {% endblock %}
                  </ol>
                </div>
              </div>
            </div>
          </div>
          <!--end::App Content Header-->

          <!--begin::App Content-->
          <div class="app-content">
            <div class="container-fluid">
              
              <!-- Flash Messages -->
              {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                  {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'warning' if category == 'warning' else 'info' }} alert-dismissible fade show" role="alert">
                      {{ message }}
                      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                  {% endfor %}
                {% endif %}
              {% endwith %}

              <!-- Main Content -->
              {% block content %}{% endblock %}
              
            </div>
          </div>
          <!--end::App Content-->
        </main>
        <!--end::App Main-->

      {% else %}
        <!-- Non-authenticated layout -->
        <div class="login-page bg-body-secondary">
          <div class="login-box">
            {% block auth_content %}{% endblock %}
          </div>
        </div>
      {% endif %}

    </div>
    <!--end::App Wrapper-->

    <!--begin::Script-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js" 
            crossorigin="anonymous"></script>
    <!--end::Third Party Plugin(OverlayScrollbars)-->

    <!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" 
            crossorigin="anonymous"></script>
    <!--end::Required Plugin(popperjs for Bootstrap 5)-->

    <!--begin::Required Plugin(Bootstrap 5)-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" 
            crossorigin="anonymous"></script>
    <!--end::Required Plugin(Bootstrap 5)-->

    <!--begin::Required Plugin(AdminLTE)-->
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0/dist/js/adminlte.min.js"></script>
    <!--end::Required Plugin(AdminLTE)-->

    <!--begin::OverlayScrollbars Configure-->
    <script>
      const SELECTOR_SIDEBAR_WRAPPER = ".sidebar-wrapper";
      const Default = {
        scrollbarTheme: "os-theme-light",
        scrollbarAutoHide: "leave",
        scrollbarClickScroll: true,
      };
      document.addEventListener("DOMContentLoaded", function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
        if (sidebarWrapper && typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== "undefined") {
          OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
            scrollbars: {
              theme: Default.scrollbarTheme,
              autoHide: Default.scrollbarAutoHide,
              clickScroll: Default.scrollbarClickScroll,
            },
          });
        }
      });
    </script>
    <!--end::OverlayScrollbars Configure-->

    <!-- Custom JavaScript -->
    {% block additional_js %}{% endblock %}

    <!--end::Script-->
  </body>
  <!--end::Body-->
</html>
